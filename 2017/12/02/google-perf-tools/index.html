<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="python | C++ | C plus plus | java"><title>使用google perf工具来排查堆外内存占用 | KL's blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" type="text/css" href="/css/donate.css"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body> <div id="particles-js"></div><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">使用google perf工具来排查堆外内存占用</h1><a id="logo" href="/.">KL's blog</a><p class="description">世事洞明皆学问，人情练达即文章</p></div><div id="nav-menu"><a href="/"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/recommendation/"><i class="fa fa-leaf"> 推荐</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">使用google perf工具来排查堆外内存占用</h1><div class="post-meta">Dec 2, 2017<span> | </span><span class="category"><a href="/categories/perf/">perf</a></span><script type="text/javascript" src="/js/busuanzi.pure.mini.js?v=0.0.0" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2017/12/02/google-perf-tools/" href="/2017/12/02/google-perf-tools/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#现象"><span class="toc-number">1.</span> <span class="toc-text">现象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tomcat的配置"><span class="toc-number">1.1.</span> <span class="toc-text">tomcat的配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java-堆外内存"><span class="toc-number">2.</span> <span class="toc-text">java 堆外内存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#限制堆外内存的大小"><span class="toc-number">2.1.</span> <span class="toc-text">限制堆外内存的大小</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#google-perf-tools"><span class="toc-number">3.</span> <span class="toc-text">google perf tools</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原理"><span class="toc-number">3.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用"><span class="toc-number">3.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析结果"><span class="toc-number">3.3.</span> <span class="toc-text">分析结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#文本形式的"><span class="toc-number">3.3.1.</span> <span class="toc-text">文本形式的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pdf形式的结果"><span class="toc-number">3.3.2.</span> <span class="toc-text">pdf形式的结果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#可能的原因"><span class="toc-number">4.</span> <span class="toc-text">可能的原因</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#heap-占用"><span class="toc-number">4.1.</span> <span class="toc-text">heap 占用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#疑点"><span class="toc-number">4.2.</span> <span class="toc-text">疑点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#杂谈"><span class="toc-number">5.</span> <span class="toc-text">杂谈</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用pmap查看进程的内存映射"><span class="toc-number">5.1.</span> <span class="toc-text">使用pmap查看进程的内存映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JDK8中的-Native-Memory-Tracker"><span class="toc-number">5.1.1.</span> <span class="toc-text">JDK8中的 Native Memory Tracker</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">6.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="post-content"><h2 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h2><p>线上机器内存不足，经常被系统<code>oom killer</code>干掉。</p>
<p>如果<code>tomcat</code>运行的好好的，突然被干掉了，没有任何线索，那么就可以使用下面的命令看看是不是<code>oom killer</code>搞的鬼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo dmesg | grep -i <span class="built_in">kill</span> | less</span><br><span class="line"></span><br><span class="line">Out of memory: Kill process 23195 (java) score 558 or sacrifice child</span><br><span class="line">Killed process 23195, UID 40001, (java) total-vm:81176732kB, anon-rss:64507900kB, file-rss:2604kB</span><br></pre></td></tr></table></figure>
<p>其中<code>anon-rss</code>是程序占用的物理内存，  64507900kB = 61.519527435302734 GB<br>系统总的内存也才<code>62GB</code>，linux发现没有可分配的内存，就会启用<code>oom killer</code>的机制，根据<code>oom_score_adj</code>的值去干掉相应的进程了。</p>
<p>系统上<code>oom_score_adj</code>的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">43722 total pagecache pages</span><br><span class="line">4335 pages in swap cache</span><br><span class="line">Swap cache stats: add 1009840, delete 1005505, find 76432470/76485037</span><br><span class="line">Free swap  = 49990420kB</span><br><span class="line">Total swap = 50331644kB</span><br><span class="line">16777215 pages RAM</span><br><span class="line">282254 pages reserved</span><br><span class="line">36481 pages shared</span><br><span class="line">16386140 pages non-shared</span><br><span class="line">[ pid ]   uid  tgid total_vm      rss cpu oom_adj oom_score_adj name</span><br><span class="line">[ 1419]     0  1419     2883       94  18     -17         -1000 udevd</span><br><span class="line">[ 2894]     0  2894     2660      105   6     -17         -1000 udevd</span><br><span class="line">[ 2895]     0  2895     2882       43   2     -17         -1000 udevd</span><br><span class="line">[  388]     0   388    16557       63  12     -17         -1000 sshd</span><br><span class="line">[ 1340]     0  1340   152806     9114   6       0             0 salt-minion</span><br><span class="line">[ 1341]     0  1341   110173     5224  22       0             0 salt-minion</span><br><span class="line">[14168]     0 14168     6899      149   6     -17         -1000 auditd</span><br></pre></td></tr></table></figure>
<p><code>tomcat</code>的进程占用内存最多，得分也最高 —— 558</p>
<h3 id="tomcat的配置"><a href="#tomcat的配置" class="headerlink" title="tomcat的配置"></a>tomcat的配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> -Xms44g -Xmx44g -server \</span><br><span class="line">-XX:+UseG1GC -XX:MaxGCPauseMillis=200 \</span><br><span class="line">-XX:InitiatingHeapOccupancyPercent=65 -XX:SurvivorRatio=8 \</span><br><span class="line">-XX:MaxTenuringThreshold=15 \</span><br><span class="line">-verbosegc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps \</span><br><span class="line">-XX:+PrintTenuringDistribution -XX:+PrintAdaptiveSizePolicy \</span><br><span class="line">-XX:-TraceClassUnloading \</span><br><span class="line">-XX:+DisableExplicitGC</span><br></pre></td></tr></table></figure>
<p>jvm最大的堆只有44GB， 但是从上面的日志中看到实际占用的内存达到了62GB，几乎把整个系统的内存都吃掉了。<br>既然堆内没有问题，问题自然应该出在堆外内存的占用上。</p>
<h2 id="java-堆外内存"><a href="#java-堆外内存" class="headerlink" title="java 堆外内存"></a>java 堆外内存</h2><p><a href="http://lovestblog.cn/blog/2015/05/12/direct-buffer/" rel="external nofollow noopener noreferrer" target="_blank">JVM源码分析之堆外内存完全解读 - 你假笨</a> 中说道：</p>
<blockquote>
<p>对于System.gc的实现，之前写了一篇文章来重点介绍，JVM源码分析之SystemGC完全解读，它会对新生代的老生代都会进行内存回收，这样会比较彻底地回收DirectByteBuffer对象以及他们关联的堆外内存，我们dump内存发现DirectByteBuffer对象本身其实是很小的，但是它后面可能关联了一个非常大的堆外内存，因此我们通常称之为『冰山对象』，我们做ygc的时候会将新生代里的不可达的DirectByteBuffer对象及其堆外内存回收了，但是无法对old里的DirectByteBuffer对象及其堆外内存进行回收，这也是我们通常碰到的最大的问题，如果有大量的DirectByteBuffer对象移到了old，但是又一直没有做cms gc或者full gc，而只进行ygc，那么我们的物理内存可能被慢慢耗光，但是我们还不知道发生了什么，因为heap明明剩余的内存还很多(前提是我们禁用了System.gc)。</p>
</blockquote>
<p>白衣大侠也建议：</p>
<blockquote>
<p>这时，就只能靠前面提到的申请额度超限时触发的system.gc()来救场了。但这道最后的保险其实也不很好，首先它会中断整个进程，然后它让当前线程睡了整整一百毫秒，而且如果gc没在一百毫秒内完成，它仍然会无情的抛出OOM异常。还有，万一，万一大家迷信某个调优指南设置了-DisableExplicitGC禁止了system.gc()，那就不好玩了。<br>所以，堆外内存还是自己主动点回收更好，比如Netty就是这么做的。</p>
</blockquote>
<h3 id="限制堆外内存的大小"><a href="#限制堆外内存的大小" class="headerlink" title="限制堆外内存的大小"></a>限制堆外内存的大小</h3><p>加上<code>-XX:MaxDirectMemorySize=4g</code>， 去除<code>-XX:+DisableExplicitG</code>观察了几天，发现并不能解决问题，于是继续使用<code>google perf tools</code>去观察下堆外内存的使用</p>
<h2 id="google-perf-tools"><a href="#google-perf-tools" class="headerlink" title="google perf tools"></a>google perf tools</h2><p><a href="https://github.com/gperftools/gperftools/tree/master" rel="external nofollow noopener noreferrer" target="_blank">下载地址</a></p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><blockquote>
<p>该工具主要利用了unix的一个环境变量LD_PRELOAD，它允许你要加载的动态库优先加载起来，相当于一个Hook了，<br>于是可以针对同一个函数可以选择不同的动态库里的实现了，比如googleperftools就是将malloc方法替换成了tcmalloc的实现，这样就可以跟踪内存分配路径了</p>
</blockquote>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p><code>tomcat</code>的启动变量中加入下面的配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> LD_PRELOAD=/usr/<span class="built_in">local</span>/lib/libtcmalloc.so</span><br><span class="line"><span class="built_in">export</span> HEAPPROFILE=/home/q/perf-result/</span><br><span class="line"><span class="built_in">export</span> HEAP_PROFILE_ALLOCATION_INTERVAL=2000000000</span><br></pre></td></tr></table></figure></p>
<p>HEAPPROFILE是存放结果的地址</p>
<blockquote>
<p>HEAP_PROFILE_ALLOCATION_INTERVAL    default: 1073741824 (1 Gb)    Dump heap profiling information once every specified number of bytes has been allocated by the program.</p>
</blockquote>
<p>查看运行中的日志:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dumping heap profile to /home/q/perf-result/_23207.0927.heap (1755151 MB allocated cumulatively, 1267 MB currently in use)</span><br></pre></td></tr></table></figure></p>
<p>日志中会显示累计的对外内存的分配和当前使用的堆外内存的大小。</p>
<h3 id="分析结果"><a href="#分析结果" class="headerlink" title="分析结果"></a>分析结果</h3><h4 id="文本形式的"><a href="#文本形式的" class="headerlink" title="文本形式的"></a>文本形式的</h4><p>命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/bin/pprof --text /home/q/java/default/bin/java _23207.0035.heap</span><br></pre></td></tr></table></figure></p>
<p>输出结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Using local file /home/q/java/default/bin/java.</span><br><span class="line">Using local file _23207.1012.heap.</span><br><span class="line">Total: 1283.1 MB</span><br><span class="line"></span><br><span class="line">     0.0   0.0% 100.0%     39.5   3.1% PtrQueue::enqueue_known_active</span><br><span class="line">     0.0   0.0% 100.0%     39.5   3.1% PtrQueueSet::allocate_buffer</span><br><span class="line">     0.0   0.0% 100.0%     42.2   3.3% G1ParTask::work</span><br><span class="line">     0.0   0.0% 100.0%     42.2   3.3% GangWorker::loop</span><br><span class="line">     0.0   0.0% 100.0%     75.6   5.9% ObjArrayKlass::oop_oop_iterate_nv_m@8fbe80</span><br><span class="line">     0.0   0.0% 100.0%    146.2  11.4% 0x00007f63bf0e5825</span><br><span class="line">     0.0   0.0% 100.0%    146.2  11.4% JVM_InternString</span><br><span class="line">     0.0   0.0% 100.0%    146.2  11.4% StringTable::intern@a24ca0</span><br><span class="line">     0.0   0.0% 100.0%    147.2  11.5% StringTable::basic_add</span><br><span class="line">     0.0   0.0% 100.0%    147.3  11.5% StringTable::intern@a24780</span><br><span class="line">     0.0   0.0% 100.0%    152.4  11.9% Hashtable::new_entry</span><br><span class="line">     0.0   0.0% 100.0%    170.5  13.3% AllocateHeap</span><br><span class="line">     0.0   0.0% 100.0%    256.0  20.0% ConcurrentMark::ConcurrentMark</span><br><span class="line">     0.0   0.0% 100.0%    265.5  20.7% InstanceKlass::oop_oop_iterate_nv</span><br><span class="line">     0.0   0.0% 100.0%    287.2  22.4% G1CollectedHeap::initialize</span><br><span class="line">     0.0   0.0% 100.0%    305.4  23.8% Universe::initialize_heap</span><br><span class="line">     0.0   0.0% 100.0%    306.3  23.9% universe_init</span><br><span class="line">     0.0   0.0% 100.0%    307.0  23.9% init_globals</span><br><span class="line">     0.0   0.0% 100.0%    307.1  23.9% JNI_CreateJavaVM</span><br><span class="line">     0.0   0.0% 100.0%    307.1  23.9% Threads::create_vm</span><br><span class="line">     0.0   0.0% 100.0%    307.2  23.9% JavaMain</span><br><span class="line">     0.0   0.0% 100.0%    326.5  25.4% ConcurrentG1RefineThread::run</span><br><span class="line">     0.0   0.0% 100.0%    326.5  25.4% RefineCardTableEntryClosure::do_card_ptr</span><br><span class="line">     0.0   0.0% 100.0%    329.8  25.7% 0x00007f63bfae74a7</span><br><span class="line">     0.0   0.0% 100.0%    348.5  27.2% DirtyCardQueueSet::apply_closure_to_completed_buffer</span><br><span class="line">     0.0   0.0% 100.0%    349.7  27.3% G1RemSet::refine_card</span><br><span class="line">     0.0   0.0% 100.0%    349.7  27.3% HeapRegion::oops_on_card_seq_iterate_careful</span><br><span class="line">     0.0   0.0% 100.0%    349.7  27.3% OtherRegionsTable::add_reference</span><br><span class="line">     0.0   0.0% 100.0%    351.0  27.4% os::malloc@913e80</span><br><span class="line">     0.0   0.0% 100.0%    351.0  27.4% Unsafe_AllocateMemory</span><br><span class="line">     0.0   0.0% 100.0%    408.4  31.8% java_start</span><br><span class="line">     0.0   0.0% 100.0%    562.6  43.8% BitMap::resize</span><br><span class="line">     0.0   0.0% 100.0%    598.5  46.6% ArrayAllocator::allocate</span><br><span class="line">     0.0   0.0% 100.0%    715.5  55.8% __clone</span><br><span class="line">     0.0   0.0% 100.0%    715.5  55.8% start_thread</span><br><span class="line">  1277.3  99.5%  99.5%   1277.3  99.5% os::malloc@9137e0</span><br></pre></td></tr></table></figure>
<p>结果代表的含义:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Analyzing Text Output</span><br><span class="line"></span><br><span class="line">Text mode has lines of output that look like this:</span><br><span class="line"></span><br><span class="line">       14   2.1%  17.2%       58   8.7% std::_Rb_tree::find</span><br><span class="line">Here is how to interpret the columns:</span><br><span class="line"></span><br><span class="line">1. Number of profiling samples in this function</span><br><span class="line">2. Percentage of profiling samples in this function</span><br><span class="line">3. Percentage of profiling samples in the functions printed so far</span><br><span class="line">4. Number of profiling samples in this function and its callees</span><br><span class="line">5. Percentage of profiling samples in this function and its callees</span><br><span class="line">6. Function name</span><br></pre></td></tr></table></figure>
<p><a href="https://gperftools.github.io/gperftools/cpuprofile.html" rel="external nofollow noopener noreferrer" target="_blank">Gperftools CPU Profiler</a>中有更加详细的说明</p>
<h4 id="pdf形式的结果"><a href="#pdf形式的结果" class="headerlink" title="pdf形式的结果"></a>pdf形式的结果</h4><p>相比文字的结果，图片形式的调用关系，更加清楚和直观。</p>
<p>命令如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install ghostscript</span><br><span class="line">sudo yum install dot</span><br><span class="line">sudo yum install graphviz -y</span><br><span class="line">sudo pprof --pdf  /home/q/java/default/bin/java _19877.19793.heap &gt; result.pdf</span><br></pre></td></tr></table></figure>
<p>结果：</p>


	<div class="row">
    <embed src="result.pdf" width="100%" height="550" type="application/pdf">
	</div>



<h2 id="可能的原因"><a href="#可能的原因" class="headerlink" title="可能的原因"></a>可能的原因</h2><p>从google perf tools的结果来看主要的堆外内存来自</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x00007f52e05126a5</span><br><span class="line">0.0 (0.0%)</span><br><span class="line">of 7089.3 (82.5%)</span><br></pre></td></tr></table></figure>
<p>这个再往上就没有地址了。</p>
<h3 id="heap-占用"><a href="#heap-占用" class="headerlink" title="heap 占用"></a>heap 占用</h3><p>查看出问题机器的<code>heap</code>占用情况如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">jmap -histo:live `pgrep -f &apos;tomcat&apos;`</span><br><span class="line"></span><br><span class="line"> num     #instances         #bytes  class name</span><br><span class="line"></span><br><span class="line">----------------------------------------------</span><br><span class="line"></span><br><span class="line">   1:      15272979      940261992  [C</span><br><span class="line"></span><br><span class="line">   2:      19182959      767318360  java.util.ArrayList</span><br><span class="line"></span><br><span class="line">   3:      15397474      739078752  qunar.tc.plato.zeno.util.collections.offheap.map.OffHeapHashMap</span><br><span class="line"></span><br><span class="line">   4:      13281544      637514112  java.util.concurrent.ConcurrentHashMap$Node</span><br><span class="line"></span><br><span class="line">   5:      10136730      612997544  [Ljava.lang.Object;</span><br><span class="line"></span><br><span class="line">   6:      15265576      488498432  java.lang.String</span><br><span class="line"></span><br><span class="line">   7:       4694324      413100512  _plato.com.qunar.hotel.price.data.center.plato.beans.shotel.IMetaSHotelBizInfo</span><br><span class="line"></span><br><span class="line">   8:           854      379525944  [Ljava.util.concurrent.ConcurrentHashMap$Node;</span><br><span class="line"></span><br><span class="line">   9:      15397474      369539376  qunar.tc.plato.zeno.util.collections.offheap.set.OffHeapHashSet</span><br><span class="line"></span><br><span class="line">  10:       4694324      337991328  _plato.com.qunar.hotel.price.data.center.plato.beans.shotel.IMetaContactConfig</span><br></pre></td></tr></table></figure>
<p>前面的都是去哪儿自己开发的堆外缓存占用的对象，缓存的内容也多是酒店相关的元数据。结合工具的结果，推测问题出在堆外缓存。<br>堆外缓存采用的是内存映射的方式，大量使用了<code>DirectByteBuffer</code>这种冰山对象。</p>
<h3 id="疑点"><a href="#疑点" class="headerlink" title="疑点"></a>疑点</h3><p>这个系统目前处于重构阶段，之前也是使用的堆外缓存，并没有出现问题。不过，目前在逐渐下掉堆外缓存的使用，到时候可以再看看是否出问题。</p>
<h2 id="杂谈"><a href="#杂谈" class="headerlink" title="杂谈"></a>杂谈</h2><h3 id="使用pmap查看进程的内存映射"><a href="#使用pmap查看进程的内存映射" class="headerlink" title="使用pmap查看进程的内存映射"></a>使用pmap查看进程的内存映射</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">sudo -u tomcat pmap -x  25147 | less</span><br><span class="line"></span><br><span class="line">Address           Kbytes     RSS   Dirty Mode   Mapping</span><br><span class="line">0000000000400000       4       0       0 r-x--  java</span><br><span class="line">0000000000600000       4       4       4 rw---  java</span><br><span class="line">0000000001d3f000    1484    1224    1224 rw---    [ anon ]</span><br><span class="line">0000003e0a400000     128     112       0 r-x--  ld-2.12.so</span><br><span class="line">0000003e0a61f000       4       4       4 r----  ld-2.12.so</span><br><span class="line">0000003e0a620000       4       4       4 rw---  ld-2.12.so</span><br><span class="line">0000003e0a621000       4       4       4 rw---    [ anon ]</span><br><span class="line">0000003e0a800000       8       8       0 r-x--  libdl-2.12.so</span><br><span class="line">0000003e0a802000    2048       0       0 -----  libdl-2.12.so</span><br><span class="line">0000003e0aa02000       4       4       4 r----  libdl-2.12.so</span><br><span class="line">0000003e0aa03000       4       4       4 rw---  libdl-2.12.so</span><br><span class="line">0000003e0ac00000    1576     680       0 r-x--  libc-2.12.so</span><br><span class="line">0000003e0ad8a000    2048       0       0 -----  libc-2.12.so</span><br><span class="line">0000003e0af8a000      16      16       8 r----  libc-2.12.so</span><br><span class="line">0000003e0af8e000       4       4       4 rw---  libc-2.12.so</span><br><span class="line">0000003e0af8f000      20      20      20 rw---    [ anon ]</span><br><span class="line">0000003e0b000000      92      72       0 r-x--  libpthread-2.12.so</span><br><span class="line">0000003e0b017000    2048       0       0 -----  libpthread-2.12.so</span><br><span class="line">0000003e0b217000       4       4       4 r----  libpthread-2.12.so</span><br><span class="line">0000003e0b218000       4       4       4 rw---  libpthread-2.12.so</span><br><span class="line">0000003e0b219000      16       4       4 rw---    [ anon ]</span><br></pre></td></tr></table></figure>
<p>将内存块的内容dump成文件（慎重，会影响服务）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo  gdb --batch --pid 25147 -ex &quot; dump memory /home/qisheng.li/c.dump 0x00007eefcc000000 0x00007eefcf000000&quot;</span><br></pre></td></tr></table></figure></p>
<p>查看文件的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[qisheng.li@xxx.h.cn2 ~]$ view c.dump</span><br></pre></td></tr></table></figure>

<p>这个dump是我在<code>2017年 09月 05日 星期二 01:34:24 CST</code>做的，但是内容看起来是tomcat respone的内容，奇怪的是内容的时间是<code>2017 17:38:18 GMT</code>，不知道是什么原因导致的，如果你知道，烦请告知。</p>
<p>直接查看堆外的内存块，无疑是最快排查堆外占用的方法，但是内存块的选择非常依赖经验， 我尝试了下，并没有找到问题。</p>
<p><code>参考5</code>中的大神，通过dump内存块，发现是netty使用的<code>directBuffer</code>分配的大量64M的内存块。</p>
<h4 id="JDK8中的-Native-Memory-Tracker"><a href="#JDK8中的-Native-Memory-Tracker" class="headerlink" title="JDK8中的 Native Memory Tracker"></a>JDK8中的 Native Memory Tracker</h4><p>在启动参数中开启：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:NativeMemoryTracking=[off | summary | detail]</span><br></pre></td></tr></table></figure></p>
<p>也可以在jvm退出的时候，打印相关的统计信息</p>
<blockquote>
<p>NMT at VM Exit<br>Use the following VM diagnostic command line option to obtain last memory usage data at VM exit when Native Memory Tracking is enabled. The level of detail is based on tracking level.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UnlockDiagnosticVMOptions -XX:+PrintNMTStatistics</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>在程序运行时可以使用<code>jcmd</code>查看内存的分配情况<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jcmd &lt;pid&gt; VM.native_memory [summary | detail | baseline | summary.diff | detail.diff | shutdown] [scale= KB | MB | GB]</span><br></pre></td></tr></table></figure></p>
<p>输出的结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo -u tomcat jcmd `pgrep -f tomcat` VM.native_memory detail</span><br><span class="line">31549:</span><br><span class="line"></span><br><span class="line">Native Memory Tracking:</span><br><span class="line"></span><br><span class="line">Total: reserved=50215227KB, committed=49947839KB</span><br><span class="line">-                 Java Heap (reserved=46137344KB, committed=46137344KB)</span><br><span class="line">                            (mmap: reserved=46137344KB, committed=46137344KB) </span><br><span class="line"> </span><br><span class="line">-                     Class (reserved=92639KB, committed=91707KB)</span><br><span class="line">                            (classes #14958)</span><br><span class="line">                            (malloc=2527KB #50184) </span><br><span class="line">                            (mmap: reserved=90112KB, committed=89180KB) </span><br><span class="line"> </span><br><span class="line">-                    Thread (reserved=914804KB, committed=914804KB)</span><br><span class="line">                            (thread #883)</span><br><span class="line">                            (stack: reserved=906696KB, committed=906696KB)</span><br><span class="line">                            (malloc=2904KB #4435) </span><br><span class="line">                            (arena=5203KB #1764)</span><br><span class="line"> </span><br><span class="line">-                      Code (reserved=263567KB, committed=87223KB)</span><br><span class="line">                            (malloc=13967KB #19565) </span><br><span class="line">                            (mmap: reserved=249600KB, committed=73256KB) </span><br><span class="line"> </span><br><span class="line">-                        GC (reserved=1849937KB, committed=1849937KB)</span><br><span class="line">                            (malloc=105041KB #121050) </span><br><span class="line">                            (mmap: reserved=1744896KB, committed=1744896KB) </span><br><span class="line"> </span><br><span class="line">-                  Compiler (reserved=13354KB, committed=13354KB)</span><br><span class="line">                            (malloc=3061KB #3484) </span><br><span class="line">                            (arena=10292KB #13)</span><br><span class="line"> </span><br><span class="line">-                  Internal (reserved=813935KB, committed=813935KB)</span><br><span class="line">                            (malloc=813903KB #102254) </span><br><span class="line">                            (mmap: reserved=32KB, committed=32KB) </span><br><span class="line"> </span><br><span class="line">-                    Symbol (reserved=18071KB, committed=18071KB)</span><br><span class="line">                            (malloc=14355KB #138545) </span><br><span class="line">                            (arena=3716KB #1)</span><br><span class="line"> </span><br><span class="line">-    Native Memory Tracking (reserved=7274KB, committed=7274KB)</span><br><span class="line">                            (malloc=298KB #4295) </span><br><span class="line">                            (tracking overhead=6976KB)</span><br><span class="line"> </span><br><span class="line">-               Arena Chunk (reserved=14191KB, committed=14191KB)</span><br><span class="line">                            (malloc=14191KB) </span><br><span class="line"> </span><br><span class="line">-                   Unknown (reserved=90112KB, committed=0KB)</span><br><span class="line">                            (mmap: reserved=90112KB, committed=0KB) </span><br><span class="line"> </span><br><span class="line">Virtual memory map:</span><br><span class="line"> </span><br><span class="line">[0x00007ef481693000 - 0x00007ef481794000] reserved and committed 1028KB for Thread Stack from</span><br><span class="line">    [0x00007f0486546f74] JavaThread::run()+0x24</span><br><span class="line">    [0x00007f04863fab88] java_start(Thread*)+0x108</span><br><span class="line"> </span><br><span class="line">[0x00007ef481794000 - 0x00007ef481895000] reserved and committed 1028KB for Thread Stack from</span><br><span class="line">    [0x00007f0486546f74] JavaThread::run()+0x24</span><br><span class="line">    [0x00007f04863fab88] java_start(Thread*)+0x108</span><br><span class="line"> </span><br><span class="line">[0x00007ef48224d000 - 0x00007ef48244d000] reserved 2048KB for Class from</span><br><span class="line">    [0x00007f0486593c66] ReservedSpace::initialize(unsigned long, unsigned long, bool, char*, unsigned long, bool)+0x256</span><br><span class="line">    [0x00007f0486593d0b] ReservedSpace::ReservedSpace(unsigned long, unsigned long, bool, char*, unsigned long)+0x1b</span><br><span class="line">    [0x00007f0486379cda] VirtualSpaceNode::VirtualSpaceNode(unsigned long)+0x17a</span><br><span class="line">    [0x00007f048637a59a] VirtualSpaceList::create_new_virtual_space(unsigned long)+0x5a</span><br><span class="line"></span><br><span class="line">	[0x00007ef48228d000 - 0x00007ef4823cd000] committed 1280KB from</span><br><span class="line">            [0x00007f0486593549] VirtualSpace::expand_by(unsigned long, bool)+0x199</span><br><span class="line">            [0x00007f0486377936] VirtualSpaceList::expand_node_by(VirtualSpaceNode*, unsigned long, unsigned long)+0x76</span><br><span class="line">            [0x00007f048637a750] VirtualSpaceList::expand_by(unsigned long, unsigned long)+0xf0</span><br><span class="line">            [0x00007f048637a8e3] VirtualSpaceList::get_new_chunk(unsigned long, unsigned long, unsigned long)+0xb3</span><br><span class="line"></span><br><span class="line">	[0x00007ef48224d000 - 0x00007ef48228d000] committed 256KB from</span><br><span class="line">            [0x00007f0486593549] VirtualSpace::expand_by(unsigned long, bool)+0x199</span><br><span class="line">            [0x00007f0486377936] VirtualSpaceList::expand_node_by(VirtualSpaceNode*, unsigned long, unsigned long)+0x76</span><br><span class="line">            [0x00007f048637a8e3] VirtualSpaceList::get_new_chunk(unsigned long, unsigned long, unsigned long)+0xb3</span><br><span class="line">            [0x00007f048637c432] SpaceManager::grow_and_allocate(unsigned long)+0x2d2</span><br></pre></td></tr></table></figure>
<img src="/2017/12/02/google-perf-tools/memory-mapping.jpg">
<p>如果通过上述的映射关系能直接找到系统的<code>StringTable</code>等对应的分区，dump内存下来应该能很快的发现问题，不知道行不行得通。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><p><a href="http://lovestblog.cn/blog/2015/08/21/rssxmx/" rel="external nofollow noopener noreferrer" target="_blank">进程物理内存远大于Xmx的问题分析 - 你假笨</a></p>
</li>
<li><p><a href="http://lovestblog.cn/blog/2015/05/12/direct-buffer/" rel="external nofollow noopener noreferrer" target="_blank">JVM源码分析之堆外内存完全解读 - 你假笨</a></p>
</li>
<li><p><a href="http://calvin1978.blogcn.com/articles/directbytebuffer.html" rel="external nofollow noopener noreferrer" target="_blank">Netty之Java堆外内存扫盲贴 | 江南白衣</a></p>
</li>
<li><p><a href="http://blog.csdn.net/jicahoo/article/details/50933469" rel="external nofollow noopener noreferrer" target="_blank">Java内存之本地内存分析神器： NMT 和 pmap - CSDN博客</a></p>
</li>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzA4MTc4NTUxNQ==&amp;mid=2650518452&amp;idx=1&amp;sn=c196bba265f888ed086b7059ca5d3fd2&amp;chksm=8780b470b0f73d66c79b7df96435d48caa8c49a9a6b696e543c0df24e3356202ccde69f2f671&amp;mpshare=1&amp;scene=1&amp;srcid=0831YG589PwShEgNLJ8CKQOp#rd" rel="external nofollow noopener noreferrer" target="_blank">Java堆外内存排查小结</a></p>
</li>
<li><p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/nmt-8.html" rel="external nofollow noopener noreferrer" target="_blank">Native Memory Tracking</a></p>
</li>
<li><p><a href="https://gperftools.github.io/gperftools/cpuprofile.html" rel="external nofollow noopener noreferrer" target="_blank">Gperftools CPU Profiler</a></p>
</li>
<li><p><a href="http://whosemario.github.io/2016/09/27/google-preftool-1/index.html" rel="external nofollow noopener noreferrer" target="_blank">Google Perftools Mac OS 安装与使用 | Whosemario的家</a></p>
</li>
</ol>
</div><footer class="post-footer"><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者: </strong>代故</li><li class="post-copyright-link"><strong>本文链接: </strong>    <a href="/2017/12/02/google-perf-tools/" target="_blank">http://qsli.github.io/2017/12/02/google-perf-tools/index.html</a></li>  <li class="post-copyright-license"><strong>版权声明: </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" rel="external nofollow noopener noreferrer" target="_blank">CC BY-NC-SA 3.0 CN</a></li></ul></div></footer><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://qsli.github.io/2017/12/02/google-perf-tools/" data-id="ck9qxc7he00enak0n8vlo64p7" class="article-share-link">分享到</a><div class="post-donate"><div id="donate_board" class="donate_bar center"><a id="btn_donate" href="javascript:;" title="打赏" class="btn_donate"></a><div class="donate_txt"> &uarr;<br>此文有用? 整杯冰阔乐!<br></div></div><div id="donate_guide" class="donate_bar center hidden"><img src="http://qsli.github.io/about/praise.jpg" title="微信打赏"></div><script type="text/javascript">document.getElementById('btn_donate').onclick = function(){
    $('#donate_board').addClass('hidden');
    $('#donate_guide').removeClass('hidden');
}</script></div><div class="tags"><a href="/tags/google-perf/">google-perf</a></div><div class="post-nav"><a href="/2017/12/02/cache-system-time/" class="pre">缓存System.currentTimeMillis的调用</a><a href="/2017/11/26/jinfo/" class="next">jinfo使用</a></div><div id="disqus_thread"><script>var disqus_shortname = 'blog-huytwsybye';
var disqus_identifier = '2017/12/02/google-perf-tools/';
var disqus_title = '使用google perf工具来排查堆外内存占用';
var disqus_url = 'http://qsli.github.io/2017/12/02/google-perf-tools/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//blog-huytwsybye.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://qsli.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/base/">base</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/db/">db</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/druid/">druid</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/dubbo/">dubbo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/fe/">fe</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/feign/">feign</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/go/">go</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/guava/">guava</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/idea/">idea</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/jdbc/">jdbc</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/jvm/">jvm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mediawiki/">mediawiki</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mybatis/">mybatis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/perf/">perf</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring/">spring</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tomcat/">tomcat</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/xml/" style="font-size: 15px;">xml</a> <a href="/tags/jackson/" style="font-size: 15px;">jackson</a> <a href="/tags/logback/" style="font-size: 15px;">logback</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/ssh/" style="font-size: 15px;">ssh</a> <a href="/tags/剪贴板/" style="font-size: 15px;">剪贴板</a> <a href="/tags/mat/" style="font-size: 15px;">mat</a> <a href="/tags/concurrent/" style="font-size: 15px;">concurrent</a> <a href="/tags/编码/" style="font-size: 15px;">编码</a> <a href="/tags/cache/" style="font-size: 15px;">cache</a> <a href="/tags/cglib/" style="font-size: 15px;">cglib</a> <a href="/tags/cygwin/" style="font-size: 15px;">cygwin</a> <a href="/tags/crontab/" style="font-size: 15px;">crontab</a> <a href="/tags/自定义标签/" style="font-size: 15px;">自定义标签</a> <a href="/tags/electron/" style="font-size: 15px;">electron</a> <a href="/tags/fabric/" style="font-size: 15px;">fabric</a> <a href="/tags/spring-cloud/" style="font-size: 15px;">spring-cloud</a> <a href="/tags/beanfactory/" style="font-size: 15px;">beanfactory</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/idea/" style="font-size: 15px;">idea</a> <a href="/tags/go学习资料/" style="font-size: 15px;">go学习资料</a> <a href="/tags/grafana/" style="font-size: 15px;">grafana</a> <a href="/tags/hexo-install/" style="font-size: 15px;">hexo install</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/lsof/" style="font-size: 15px;">lsof</a> <a href="/tags/template/" style="font-size: 15px;">template</a> <a href="/tags/jar/" style="font-size: 15px;">jar</a> <a href="/tags/访问权限/" style="font-size: 15px;">访问权限</a> <a href="/tags/Javadoc/" style="font-size: 15px;">Javadoc</a> <a href="/tags/exception/" style="font-size: 15px;">exception</a> <a href="/tags/java-connector/" style="font-size: 15px;">java-connector</a> <a href="/tags/jinfo/" style="font-size: 15px;">jinfo</a> <a href="/tags/ajax/" style="font-size: 15px;">ajax</a> <a href="/tags/tomcat/" style="font-size: 15px;">tomcat</a> <a href="/tags/markdown-here/" style="font-size: 15px;">markdown-here</a> <a href="/tags/自增主键/" style="font-size: 15px;">自增主键</a> <a href="/tags/mindmap/" style="font-size: 15px;">mindmap</a> <a href="/tags/plantuml/" style="font-size: 15px;">plantuml</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/netcat/" style="font-size: 15px;">netcat</a> <a href="/tags/uml/" style="font-size: 15px;">uml</a> <a href="/tags/postgresql/" style="font-size: 15px;">postgresql</a> <a href="/tags/pip/" style="font-size: 15px;">pip</a> <a href="/tags/python-util/" style="font-size: 15px;">python-util</a> <a href="/tags/re/" style="font-size: 15px;">re</a> <a href="/tags/shadowsocks/" style="font-size: 15px;">shadowsocks</a> <a href="/tags/limit/" style="font-size: 15px;">limit</a> <a href="/tags/spi/" style="font-size: 15px;">spi</a> <a href="/tags/spring-mvc/" style="font-size: 15px;">spring mvc</a> <a href="/tags/sqlserver-killer/" style="font-size: 15px;">sqlserver-killer</a> <a href="/tags/sudo-log/" style="font-size: 15px;">sudo-log</a> <a href="/tags/swap/" style="font-size: 15px;">swap</a> <a href="/tags/access-log/" style="font-size: 15px;">access-log</a> <a href="/tags/busy-thread/" style="font-size: 15px;">busy-thread</a> <a href="/tags/encoding/" style="font-size: 15px;">encoding</a> <a href="/tags/connections/" style="font-size: 15px;">connections</a> <a href="/tags/string-manager/" style="font-size: 15px;">string-manager</a> <a href="/tags/servlet/" style="font-size: 15px;">servlet</a> <a href="/tags/executeBatch/" style="font-size: 15px;">executeBatch</a> <a href="/tags/format/" style="font-size: 15px;">format</a> <a href="/tags/druid/" style="font-size: 15px;">druid</a> <a href="/tags/generic/" style="font-size: 15px;">generic</a> <a href="/tags/executor/" style="font-size: 15px;">executor</a> <a href="/tags/greys/" style="font-size: 15px;">greys</a> <a href="/tags/event-bus/" style="font-size: 15px;">event-bus</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/reference/" style="font-size: 15px;">reference</a> <a href="/tags/resource/" style="font-size: 15px;">resource</a> <a href="/tags/sudo/" style="font-size: 15px;">sudo</a> <a href="/tags/top/" style="font-size: 15px;">top</a> <a href="/tags/volatile/" style="font-size: 15px;">volatile</a> <a href="/tags/messageConverter/" style="font-size: 15px;">messageConverter</a> <a href="/tags/google-perf/" style="font-size: 15px;">google-perf</a> <a href="/tags/jdwp/" style="font-size: 15px;">jdwp</a> <a href="/tags/spring-bean/" style="font-size: 15px;">spring-bean</a> <a href="/tags/placeholder/" style="font-size: 15px;">placeholder</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/05/03/jdbc-batching/">jdbc-batching</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/03/jdbc-connector/">mysql jdbc驱动参数性能调优</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/01/crontab/">crontab和邮件</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/01/sudo-log/">配置sudo.log</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/29/spring-bean-duplic-name/">Spring中bean name重复的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/28/feign-method-timeout/">Feign方法级别的超时</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/27/tomcat-busy-thread/">tomcat busy thread如何统计的</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/25/druid-conn-leak/">Druid连接泄露记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/23/mediawiki-plantuml/">mediawiki-plantuml</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/23/cglib-tips/">cglib-tips</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//blog-huytwsybye.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://iip.whu.edu.cn/" title="武汉大学智能信息处理实验室" target="_blank" rel="external nofollow noopener noreferrer">武汉大学智能信息处理实验室</a><ul></ul><a href="http://calvin1978.blogcn.com/" title="江南白衣" target="_blank" rel="external nofollow noopener noreferrer">江南白衣</a><ul></ul><a href="https://chenyuzuoo.github.io/" title="Chenyu's Script" target="_blank" rel="external nofollow noopener noreferrer">Chenyu's Script</a><ul></ul><a href="https://zhangpengdeshu.github.io/" title="前端小胖儿" target="_blank" rel="external nofollow noopener noreferrer">前端小胖儿</a><ul></ul><a href="http://huzongzhe.cn/" title="胡大腿" target="_blank" rel="external nofollow noopener noreferrer">胡大腿</a></div><div class="widget"><div class="widget-title"><i class="fa fa-eye"> 本站访问量</i></div><div><script type="text/javascript" src="/js/busuanzi.pure.mini.js?v=0.0.0" async="async"></script><p> 访问量:<span id="busuanzi_value_site_pv"> </span></p><p> 访客数:<span id="busuanzi_value_site_uv"></span></p></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer"><p><a href="/." rel="nofollow">KL's blog </a><span>© 2015 - 2020.</span></p><p> Powered by<a rel="external nofollow noopener noreferrer" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="external nofollow noopener noreferrer" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="external nofollow noopener noreferrer" target="_blank" href="https://github.com/pagecho"> Cho.</a></p></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="/js/kity.min.js?v=0.0.0" sync></script><script type="text/javascript" src="/js/kityminder.core.js?v=0.0.0" sync></script><script type="text/javascript" src="/js/mindmap.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?b86170f998d4ba7d7e834894b1f02595";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>